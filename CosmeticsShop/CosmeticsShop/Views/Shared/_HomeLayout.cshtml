<!--A Design by W3layouts
Author: W3layout
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html>
<head>
    <title>@ViewBag.Title</title>
    <link href="~/Content/css/bootstrap-3.1.1.min.css" rel='stylesheet' type='text/css' />
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="~/Content/js/jquery.min.js"></script>
    <!-- Custom Theme files -->
    <!--theme-style-->
    <link href="~/Content/css/style.css" rel="stylesheet" type="text/css" media="all" />
    <!--//theme-style-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="@ViewBag.Title" />
    <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
    <link href='//fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- start menu -->
    <script src="~/Content/js/bootstrap.min.js"></script>
    <!-- slide -->
    <!-- animation-effect -->
    <link href="~/Content/css/animate.min.css" rel="stylesheet">
    <script src="~/Content/js/wow.min.js"></script>
    <script>
        new WOW().init();
    </script>
    <style>

        body, html {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            position: relative;
            font-family: 'Raleway', sans-serif;
        }

        .main-content {
            padding-bottom: 180px;
        }

        footer.footer {
            background-color: #f8f8f8;
            border-top: 1px solid #ddd;
            padding: 20px 0;
            width: 100%;
            box-sizing: border-box;
        }

        <style >
        .navbar-nav > li > a {
            color: #6f4e7c;
            font-weight: 600;
            font-size: 16px;
            padding: 12px 20px;
            position: relative;
        }

        .navbar-nav > li.active > a {
            color: #d98fb3; /* chữ màu hồng cho active */
        }

            .navbar-nav > li.active > a::after {
                content: "";
                position: absolute;
                left: 0;
                bottom: 0;
                width: 100%;
                height: 2px;
                background-color: #d98fb3; /* thanh màu hồng */
            }
    </style>


    </style>
    <!-- //animation-effect -->
</head>
<body>
    <!-- Thêm link Bootstrap 3 CSS & glyphicon -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Nếu muốn vẫn dùng Bootstrap Icons thì thêm link bên dưới, không bắt buộc -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

    @{
        CosmeticsShop.Models.User user = Session["User"] as CosmeticsShop.Models.User;
    }

<div class="header">
    <div class="header-top bg-light border-bottom">
        <div class="container d-flex align-items-center justify-content-between" style="padding: 10px 0; display: flex; align-items: center; justify-content: space-between;">

            <!-- Logo -->
            <div class="logo animated wow fadeInLeft" data-wow-delay=".5s">
                <h1 style="margin: 0;">
                    <a href="@Url.Action("Index", "Home")" class="text-primary" style="font-weight: bold; text-decoration:none; font-size: 28px;">
                        Cosmetics <span class="text-danger">Shop</span>
                    </a>
                </h1>
            </div>

            <!-- Giỏ hàng + Người dùng + Đăng nhập/Đăng ký/Đăng xuất + Tìm kiếm -->
            <div class="header-actions" style="display: flex; align-items: center; font-size: 16px;">

                <!-- Giỏ hàng -->
                <div class="cart box_1 position-relative" style="display: flex; align-items: center; margin-right: 20px;">
                    <a href="/Cart/Checkout" class="text-dark" style="font-weight: 600; text-decoration:none; display: flex; align-items: center;">
                        <div class="total" style="margin-right: 10px; font-size: 18px;">
                            @{
                                List<CosmeticsShop.Models.ItemCart> itemCarts = Session["Cart"] as List<CosmeticsShop.Models.ItemCart>;
                                if (itemCarts != null && itemCarts.Count > 0)
                                {
                                    <span class="simpleCart_total">
                                        @itemCarts.Sum(x => x.ProductPrice * x.Quantity).ToString("#,##")₫ (@itemCarts.Sum(x => x.Quantity))
                                    </span>
                                }
                                else
                                {
                                    <span class="simpleCart_total">0₫ (0)</span>
                                }
                            }
                        </div>
                        <img src="~/Content/images/cart.png" alt="Giỏ hàng" style="width:32px; height:32px;" />
                    </a>
                </div>

                <!-- Người dùng hoặcx nút Đăng nhập/Đăng ký -->
                @if (user != null)
                {
                    <input type="hidden" id="UserID" value="@user.ID" />
                    <a href="/User/CheckoutOrder" class="text-primary" style="font-weight: 600; margin-right: 15px; font-size:18px; text-decoration:none; display: flex; align-items: center;">
                        <i class="glyphicon glyphicon-user" style="margin-right: 5px; font-size: 20px;"></i> @user.Name
                    </a>
                    <a href="/Home/SignOut" class="btn btn-danger btn-lg" style="font-size:16px; padding:8px 14px;">Đăng xuất</a>
                }
                else
                {
                    <a href="/Home/SignUp" class="btn btn-default btn-lg" style="margin-right: 10px; font-size:16px; padding:8px 14px;">Đăng ký</a>
                    <a href="/Home/SignIn" class="btn btn-primary btn-lg" style="font-size:16px; padding:8px 14px;">Đăng nhập</a>
                }

                <!-- Icon tìm kiếm -->
                <a class="play-icon popup-with-zoom-anim" href="#small-dialog" title="Tìm kiếm" style="margin-left: 15px; font-size: 22px; color: #6c757d;">
                    <i class="glyphicon glyphicon-search"></i>
                </a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="head-top">
            <div class="n-avigation">
                <nav class="navbar" role="navigation" style="background-color: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom:0;">
                    <div class="container-fluid">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-megadropdown-tabs" aria-expanded="false" style="border-color:#d98fb3;">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar" style="background-color:#d98fb3;"></span>
                                <span class="icon-bar" style="background-color:#d98fb3;"></span>
                                <span class="icon-bar" style="background-color:#d98fb3;"></span>
                            </button>
                        </div>

                        <div class="collapse navbar-collapse" id="bs-megadropdown-tabs">
                            <ul class="nav navbar-nav">
                                <li class="@(ViewBag.Title == "Trang chủ" ? "active" : "")">
                                    <a href="@Url.Action("Index", "Home")" style="color:#d98fb3; font-weight:600; font-size:16px; padding:12px 20px; border-bottom: 2px solid #d98fb3;">
                                        Trang chủ
                                    </a>
                                </li>
                                <li class="@(ViewBag.Title == "Sản phẩm" ? "active" : "")">
                                    <a href="@Url.Action("Index", "Product")" style="color:#6f4e7c; font-weight:600; font-size:16px; padding:12px 20px;">
                                        Sản phẩm
                                    </a>
                                </li>
                                <li class="@(ViewBag.Title == "Giới thiệu" ? "active" : "")">
                                    <a href="@Url.Action("About", "Home")" style="color:#6f4e7c; font-weight:600; font-size:16px; padding:12px 20px;">
                                        Giới thiệu
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>

            <div class="clearfix"></div>

            <!---pop-up-box---->
            <link href="~/Content/css/popuo-box.css" rel="stylesheet" type="text/css" media="all" />
            <script src="~/Content/js/jquery.magnific-popup.js" type="text/javascript"></script>
            <!---//pop-up-box---->
            <div id="small-dialog" class="mfp-hide">
                <div class="search-top">
                    <div class="login">
                        <form action="/Product/Index" method="get">
                            <input type="submit" value="" />
                            <input type="text" name="keyword" value="Nhập vào từ khóa..." onfocus="this.value = '';" onblur="if (this.value == '') {this.value = '';}" />
                        </form>
                    </div>
                </div>
            </div>
            <script>
                $(document).ready(function () {
                    $('.popup-with-zoom-anim').magnificPopup({
                        type: 'inline',
                        fixedContentPos: false,
                        fixedBgPos: true,
                        overflowY: 'auto',
                        closeBtnInside: true,
                        preloader: false,
                        midClick: true,
                        removalDelay: 300,
                        mainClass: 'my-mfp-zoom-in'
                    });
                });
            </script>

        </div>
    </div>
</div>

    <!-- Thêm script Bootstrap JS 3.x ở cuối trang -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <div class="main-content">
        @RenderBody()
    </div>
    <!--<div class="chatbox chatbox22 chatbox--tray">
        <div class="chatbox__title">
            <h5><a href="javascript:void()">Chat với chúng tôi</a></h5>-->
            <!--<button class="chatbox__title__tray">
                <span></span>
            </button>-->
            <!--<button class="chatbox__title__close">
                <span>
                    <svg viewBox="0 0 12 12" width="12px" height="12px">
                        <line stroke="#FFFFFF" x1="11.75" y1="0.25" x2="0.25" y2="11.75"></line>
                        <line stroke="#FFFFFF" x1="11.75" y1="11.75" x2="0.25" y2="0.25"></line>
                    </svg>
                </span>
            </button>
        </div>
        @if (Session["User"] == null)
        {
            <div class="chatbox__body">
                <h5>Vui lòng đăng nhập để chat</h5>
            </div>
        }
        else
        {
            <div class="chatbox__body">

            </div>
            <div class="panel-footer">
                <div class="input-group">
                    <input id="btn-input" type="text" required class="form-control input-sm chat_set_height" placeholder="Soạn tin nhắn..." tabindex="0" dir="ltr" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off" contenteditable="true" />
                    <span class="input-group-btn">
                        <button class="btn bt_bg btn-sm" id="btn-chat">
                            Gửi
                        </button>
                        <img src="~/Content/images/loading.gif" class="loading-send btn bt_bg btn-sm" style="display:none;" />
                    </span>
                </div>
            </div>
        }
    </div>-->
    <script type="text/javascript">
        $(document).ready(function () {
            $(function () {
                var chat = $.connection.chatHubs
                chat.client.displayMessage = function () {
                    getAllData();
                }
                $.connection.hub.start();
                getAllData();
            })
            var lastMessID = 0;
            function getAllData() {
                var chatbox = $('.chatbox__body');
                var userID = $('#UserID').val();
                $.ajax({
                    url: location.origin + "/Chat/GetAllMessageChating?UserID=" + userID,
                    type: 'GET',
                    dataType: 'JSON',
                    success: function (data) {
                        chatbox.empty()
                        if (data.length > 0) {
                            $.each(data, function (i, model) {
                                var date = new Date(parseInt(model.CreatedDate.substr(6)));
                                if (model.FromUserID == userID) {
                                    lastMessID = model.ID;
                                    chatbox.append(
                                        '<div class="chatbox__body__message chatbox__body__message--right" id="' + model.ID + '"' + '>' +
                                        ' <div class="chatbox_timing">' +
                                        '<ul>' +
                                        '<li>' + date.getHours() + ':' + date.getMinutes() + '</li>' +
                                        '</ul>' +
                                        '</div>' +
                                        '<img src="/Content/images/' + model.FromAvatarUser + '" alt="Picture">' +
                                        '<div class="clearfix"></div>' +
                                        ' <div class="ul_section_full">' +
                                        ' <ul class="ul_msg">' +
                                        '<li><strong>' + model.FromUserName + '</strong></li>' +
                                        '<li>' + model.Content + '</li>' +
                                        '</ul>' +
                                        '<div class="clearfix"></div>' +
                                        '</div>' +
                                        '</div>'
                                    );
                                } else {
                                    chatbox.append(
                                        '<div class="chatbox__body__message chatbox__body__message--left" id="' + model.ID + '"' + '>' +
                                        ' <div class="chatbox_timing">' +
                                        '<ul>' +
                                        '<li>' + date.getHours() + ':' + date.getMinutes() + '</li>' +
                                        '</ul>' +
                                        '</div>' +
                                        '<img src="/Content/images/' + model.FromAvatarUser + '" alt="Picture">' +
                                        '<div class="clearfix"></div>' +
                                        ' <div class="ul_section_full">' +
                                        ' <ul class="ul_msg">' +
                                        '<li><strong>' + model.FromUserName + '</strong></li>' +
                                        '<li>' + model.Content + '</li>' +
                                        '</ul>' +
                                        '<div class="clearfix"></div>' +
                                        '</div>' +
                                        '</div>'
                                    );
                                }
                            })
                        } else {
                            chatbox.append(
                                '<p>Chưa có tin nhắn...</p>'
                            );
                        }
                    }
                })
                $(".chatbox__body").animate({ scrollTop: 2000000 });
            }
            function getLastData() {
                var chatbox = $('.chatbox__body');
                var userID = $('#UserID').val();
                $.ajax({
                    url: location.origin + "/Chat/GetLastMessageClient?UserID=" + userID,
                    type: 'GET',
                    dataType: 'JSON',
                    success: function (data) {
                        var date = new Date(parseInt(data.CreatedDate.substr(6)));
                        chatbox.append(
                            '<div class="chatbox__body__message chatbox__body__message--right">' +
                            ' <div class="chatbox_timing">' +
                            '<ul>' +
                            '<li>' + date.getHours() + ':' + date.getMinutes() + '</li>' +
                            '</ul>' +
                            '</div>' +
                            '<img src="/Content/images/' + data.FromAvatarUser + '" alt="Picture">' +
                            '<div class="clearfix"></div>' +
                            ' <div class="ul_section_full">' +
                            ' <ul class="ul_msg">' +
                            '<li><strong>' + data.FromUserName + '</strong></li>' +
                            '<li>' + data.Content + '</li>' +
                            '</ul>' +
                            '<div class="clearfix"></div>' +
                            '</div>' +
                            '</div>')
                    }
                })
            }
            $('#btn-chat').click(function send() {
                var fromId = $('#UserID').val();
                var content = $('#btn-input').val();
                $.ajax({
                    url: location.origin + "/Chat/Send",
                    data: { FromUserID: fromId, ToUserID: 1, Content: content, Side: "Client" },
                    type: 'POST',
                    dataType: 'JSON',
                    success: function (data) {
                        if (data.status) {
                            $.notify("Đã gửi!", "success");
                            $("#btn-chat").show();
                            $(".loading-send").hide();
                            getLastData();
                            $('#btn-input').val("");
                            $(".chatbox__body").animate({ scrollTop: 2000000 });
                        } else {
                            $.notify("Có lỗi xảy ra!", "error");
                            return;
                        }
                    }
                })
                $("#btn-chat").hide();
                $(".loading-send").show();
            })
        });
    </script>

    <script src="~/Content/js/notify.min.js"></script>

    <script src="~/Scripts/jquery.signalR-2.4.2.min.js"></script>
    <script src="~/signalr/hubs" type="text/javascript"></script>
    <link href="~/Content/css/chatbox.css" rel="stylesheet" />
    <script src="~/Content/js/chatbox.js"></script>

    @RenderSection("Scripts", required: false)

</body>
</html>